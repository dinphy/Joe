function wordObj(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}var curPunc,keywordList=["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"],keywords=wordObj(keywordList),indentWords=wordObj(["def","class","case","for","while","until","module","then","catch","loop","proc","begin"]),dedentWords=wordObj(["end","until"]),opening={"[":"]","{":"}","(":")"},closing={"]":"[","}":"{",")":"("};function chain(e,t,n){return n.tokenize.push(e),e(t,n)}function tokenBase(e,t){if(e.sol()&&e.match("=begin")&&e.eol())return t.tokenize.push(readBlockComment),"comment";if(e.eatSpace())return null;var n,r=e.next();if("`"==r||"'"==r||'"'==r)return chain(readQuoted(r,"string",'"'==r||"`"==r),e,t);if("/"==r)return regexpAhead(e)?chain(readQuoted(r,"string.special",!0),e,t):"operator";if("%"==r){var o="string",a=!0;e.eat("s")?o="atom":e.eat(/[WQ]/)?o="string":e.eat(/[r]/)?o="string.special":e.eat(/[wxq]/)&&(a=!(o="string"));var i=e.eat(/[^\w\s=]/);return i?chain(readQuoted(i=opening.propertyIsEnumerable(i)?opening[i]:i,o,a,!0),e,t):"operator"}if("#"==r)return e.skipToEnd(),"comment";if("<"==r&&(n=e.match(/^<([-~])[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return chain(readHereDoc(n[2],n[1]),e,t);if("0"==r)return e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/),"number";if(/\d/.test(r))return e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if("?"==r){for(;e.match(/^\\[CM]-/););return e.eat("\\")?e.eatWhile(/\w/):e.next(),"string"}if(":"==r)return e.eat("'")?chain(readQuoted("'","atom",!1),e,t):e.eat('"')?chain(readQuoted('"',"atom",!0),e,t):e.eat(/[\<\>]/)?(e.eat(/[\<\>]/),"atom"):e.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":e.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(e.eatWhile(/[\w$\xa1-\uffff]/),e.eat(/[\?\!\=]/),"atom"):"operator";if("@"==r&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/))return e.eat("@"),e.eatWhile(/[\w\xa1-\uffff]/),"propertyName";if("$"==r)return e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next(),"variableName.special";if(/[a-zA-Z_\xa1-\uffff]/.test(r))return e.eatWhile(/[\w\xa1-\uffff]/),e.eat(/[\?\!]/),e.eat(":")?"atom":"variable";if("|"!=r||!t.varList&&"{"!=t.lastTok&&"do"!=t.lastTok){if(/[\(\)\[\]{}\\;]/.test(r))return curPunc=r,null;if("-"==r&&e.eat(">"))return"operator";if(/[=+\-\/*:\.^%<>~|]/.test(r)){t=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);return"."!=r||t||(curPunc="."),"operator"}return null}return curPunc="|",null}function regexpAhead(e){for(var t,n=e.pos,r=0,o=!1,a=!1;null!=(t=e.next());)if(a)a=!1;else{if(-1<"[{(".indexOf(t))r++;else if(-1<"]})".indexOf(t)){if(--r<0)break}else if("/"==t&&0==r){o=!0;break}a="\\"==t}return e.backUp(e.pos-n),o}function tokenBaseUntilBrace(n){return n=n||1,function(e,t){if("}"==e.peek()){if(1==n)return t.tokenize.pop(),t.tokenize[t.tokenize.length-1](e,t);t.tokenize[t.tokenize.length-1]=tokenBaseUntilBrace(n-1)}else"{"==e.peek()&&(t.tokenize[t.tokenize.length-1]=tokenBaseUntilBrace(n+1));return tokenBase(e,t)}}function tokenBaseOnce(){var n=!1;return function(e,t){return n?(t.tokenize.pop(),t.tokenize[t.tokenize.length-1](e,t)):(n=!0,tokenBase(e,t))}}function readQuoted(o,a,i,u){return function(e,t){var n,r=!1;for("read-quoted-paused"===t.context.type&&(t.context=t.context.prev,e.eat("}"));null!=(n=e.next());){if(n==o&&(u||!r)){t.tokenize.pop();break}if(i&&"#"==n&&!r){if(e.eat("{")){"}"==o&&(t.context={prev:t.context,type:"read-quoted-paused"}),t.tokenize.push(tokenBaseUntilBrace());break}if(/[@\$]/.test(e.peek())){t.tokenize.push(tokenBaseOnce());break}}r=!r&&"\\"==n}return a}}function readHereDoc(n,r){return function(e,t){return r&&e.eatSpace(),e.match(n)?t.tokenize.pop():e.skipToEnd(),"string"}}function readBlockComment(e,t){return e.sol()&&e.match("=end")&&e.eol()&&t.tokenize.pop(),e.skipToEnd(),"comment"}const ruby={startState:function(e){return{tokenize:[tokenBase],indented:0,context:{type:"top",indented:-e},continuedLine:!1,lastTok:null,varList:!1}},token:function(e,t){curPunc=null,e.sol()&&(t.indented=e.indentation());var n,r,o=t.tokenize[t.tokenize.length-1](e,t),a=curPunc;return"variable"==o&&(r=e.current(),"keyword"==(o="."==t.lastTok?"property":keywords.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(r)?"tag":"def"==t.lastTok||"class"==t.lastTok||t.varList?"def":"variable")&&(indentWords.propertyIsEnumerable(a=r)?n="indent":dedentWords.propertyIsEnumerable(r)?n="dedent":(("if"==r||"unless"==r)&&e.column()==e.indentation()||"do"==r&&t.context.indented<t.indented)&&(n="indent"))),(curPunc||o&&"comment"!=o)&&(t.lastTok=a),"|"==curPunc&&(t.varList=!t.varList),"indent"==n||/[\(\[\{]/.test(curPunc)?t.context={prev:t.context,type:curPunc||o,indented:t.indented}:("dedent"==n||/[\)\]\}]/.test(curPunc))&&t.context.prev&&(t.context=t.context.prev),e.eol()&&(t.continuedLine="\\"==curPunc||"operator"==o),o},indent:function(e,t,n){if(e.tokenize[e.tokenize.length-1]!=tokenBase)return null;var r=t&&t.charAt(0),o=e.context,t=o.type==closing[r]||"keyword"==o.type&&/^(?:end|until|else|elsif|when|rescue)\b/.test(t);return o.indented+(t?0:n.unit)+(e.continuedLine?n.unit:0)},languageData:{indentOnInput:/^\s*(?:end|rescue|elsif|else|\})$/,commentTokens:{line:"#"},autocomplete:keywordList}};export{ruby};
