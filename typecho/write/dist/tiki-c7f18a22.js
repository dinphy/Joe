function inBlock(n,r,i){return function(t,e){for(;!t.eol();){if(t.match(r)){e.tokenize=inText;break}t.next()}return i&&(e.tokenize=i),n}}function inLine(n){return function(t,e){for(;!t.eol();)t.next();return e.tokenize=inText,n}}function inText(e,n){function t(t){return(n.tokenize=t)(e,n)}var r=e.sol(),i=e.next();switch(i){case"{":return e.eat("/"),e.eatSpace(),e.eatWhile(/[^\s\u00a0=\"\'\/?(}]/),n.tokenize=inPlugin,"tag";case"_":if(e.eat("_"))return t(inBlock("strong","__",inText));break;case"'":if(e.eat("'"))return t(inBlock("em","''",inText));break;case"(":if(e.eat("("))return t(inBlock("link","))",inText));break;case"[":return t(inBlock("url","]",inText));case"|":if(e.eat("|"))return t(inBlock("comment","||"));break;case"-":if(e.eat("="))return t(inBlock("header string","=-",inText));if(e.eat("-"))return t(inBlock("error tw-deleted","--",inText));break;case"=":if(e.match("=="))return t(inBlock("tw-underline","===",inText));break;case":":if(e.eat(":"))return t(inBlock("comment","::"));break;case"^":return t(inBlock("tw-box","^"));case"~":if(e.match("np~"))return t(inBlock("meta","~/np~"))}if(r)switch(i){case"!":return e.match("!!!!!")||e.match("!!!!")||e.match("!!!")||e.match("!!"),t(inLine("header string"));case"*":case"#":case"+":return t(inLine("tw-listitem bracket"))}return null}var pluginName,type,curState,setStyle;function inPlugin(t,e){var n=t.next(),r=t.peek();return"}"==n?(e.tokenize=inText,"tag"):"("==n||")"==n?"bracket":"="==n?(type="equals",">"==r&&(t.next(),r=t.peek()),/[\'\"]/.test(r)||(e.tokenize=inAttributeNoQuote()),"operator"):/[\'\"]/.test(n)?(e.tokenize=inAttribute(n),e.tokenize(t,e)):(t.eatWhile(/[^\s\u00a0=\"\'\/?]/),"keyword")}function inAttribute(n){return function(t,e){for(;!t.eol();)if(t.next()==n){e.tokenize=inPlugin;break}return"string"}}function inAttributeNoQuote(){return function(t,e){for(;!t.eol();){var n=t.next(),r=t.peek();if(" "==n||","==n||/[ )}]/.test(r)){e.tokenize=inPlugin;break}}return"string"}}function pass(){for(var t=arguments.length-1;0<=t;t--)curState.cc.push(arguments[t])}function cont(){return pass.apply(null,arguments),!0}function pushContext(t,e){var n=curState.context&&curState.context.noIndent;curState.context={prev:curState.context,pluginName:t,indent:curState.indented,startOfLine:e,noIndent:n}}function popContext(){curState.context&&(curState.context=curState.context.prev)}function element(t){if("openPlugin"==t)return curState.pluginName=pluginName,cont(attributes,endplugin(curState.startOfLine));if("closePlugin"!=t)return"string"==t&&(curState.context&&"!cdata"==curState.context.name||pushContext("!cdata"),curState.tokenize==inText&&popContext()),cont();t=!1;return curState.context?(t=curState.context.pluginName!=pluginName,popContext()):t=!0,t&&(setStyle="error"),cont(endcloseplugin(t))}function endplugin(e){return function(t){return"selfclosePlugin"==t||"endPlugin"==t||"endPlugin"==t&&pushContext(curState.pluginName,e),cont()}}function endcloseplugin(e){return function(t){return e&&(setStyle="error"),("endPlugin"==t?cont:pass)()}}function attributes(t){return"keyword"==t?(setStyle="attribute",cont(attributes)):"equals"==t?cont(attvalue,attributes):pass()}function attvalue(t){return"keyword"==t?(setStyle="string",cont()):"string"==t?cont(attvaluemaybe):pass()}function attvaluemaybe(t){return"string"==t?cont(attvaluemaybe):pass()}const tiki={startState:function(){return{tokenize:inText,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function(t,e){if(t.sol()&&(e.startOfLine=!0,e.indented=t.indentation()),t.eatSpace())return null;setStyle=type=pluginName=null;var n=e.tokenize(t,e);if((n||type)&&"comment"!=n)for(curState=e;;)if((e.cc.pop()||element)(type||n))break;return e.startOfLine=!1,setStyle||n},indent:function(t,e,n){var r=t.context;if(r&&r.noIndent)return 0;for(r&&/^{\//.test(e)&&(r=r.prev);r&&!r.startOfLine;)r=r.prev;return r?r.indent+n.unit:0}};export{tiki};
