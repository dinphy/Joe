import{C as ContextTracker,E as ExternalTokenizer,P as Parser,o as NodeProp,j as LezerLanguage,e as indentNodeProp,h as foldNodeProp,a as styleTags,t as tags,n as LanguageSupport,s as syntaxTree}from"./index.js";const StartTag=1,StartCloseTag=2,mismatchedStartCloseTag=3,incompleteStartCloseTag=4,commentContent=35,piContent=36,cdataContent=37,Element$1=9,OpenTag=11;function nameChar(e){return 45==e||46==e||58==e||65<=e&&e<=90||95==e||97<=e&&e<=122||161<=e}function isSpace(e){return 9==e||10==e||13==e||32==e}let cachedName=null,cachedInput=null,cachedPos=0;function tagNameAfter(e,t){if(cachedPos==t&&cachedInput==e)return cachedName;let O=e.get(t);for(;isSpace(O);)O=e.get(++t);for(var a=t;nameChar(O);)O=e.get(++t);return cachedInput=e,cachedPos=t,cachedName=a<t?e.read(a,t).toLowerCase():null}function ElementContext(t,e){this.name=t,this.parent=e,this.hash=e?e.hash:0;for(let e=0;e<t.length;e++)this.hash+=(this.hash<<4)+t.charCodeAt(e)+(t.charCodeAt(e)<<8)}const elementContext=new ContextTracker({start:null,shift(e,t,O,a){return t==StartTag?new ElementContext(tagNameAfter(O,a.pos)||"",e):e},reduce(e,t){return t==Element$1&&e?e.parent:e},reuse(e,t,O,a){var n=t.type.id;return n==StartTag||n==OpenTag?new ElementContext(tagNameAfter(O,a.pos-t.length+1)||"",e):e},hash(e){return e?e.hash:0},strict:!1}),startTag=new ExternalTokenizer((e,t,O)=>{let a=t.start;if(60==e.get(a++)){var n=e.get(a);if(47==n){a++;var r=tagNameAfter(e,a);if(!r)return t.accept(incompleteStartCloseTag,a);if(O.context&&r==O.context.name)return t.accept(StartCloseTag,a);for(let e=O.context;e;e=e.parent)if(e.name==r)return;t.accept(mismatchedStartCloseTag,a)}else if(33!=n&&63!=n)return t.accept(StartTag,a)}});function scanTo(r,o){return new ExternalTokenizer((e,t)=>{let O=t.start,a=0;for(;;){var n=e.get(O);if(n<0)break;if(O++,n==o.charCodeAt(a)){if(a++,a==o.length){O-=o.length;break}}else a=0}O>t.start&&t.accept(r,O)})}const commentContent$1=scanTo(commentContent,"--\x3e"),piContent$1=scanTo(piContent,"?>"),cdataContent$1=scanTo(cdataContent,"?>"),parser=Parser.deserialize({version:13,states:"-OOQOaOOOcObO'#CbOkOdO'#CcOOOP'#Cu'#CuOsOaO'#DSO!XOaOOOOOQ'#Cv'#CvO!aObO,58|OOOP,58|,58|OOOS'#Cw'#CwO!iOdO,58}OOOP,58},58}OOOP-E6s-E6sO!qO`O'#CgO!yOqO'#CeOOOP'#Ce'#CeO#kOaO'#CxQ#|OPOOO$ROaOOOOOQ-E6t-E6tOOOP1G.h1G.hOOOS-E6u-E6uOOOP1G.i1G.iOOOO'#Cy'#CyO$aO`O,59RO$iO!bO,59RO$wOhO'#CpO%PO`O'#CqOOOP'#D['#D[OOOP'#C|'#C|O!yOqO,59PO%XO`O'#CrOOOP,59P,59POOOP,59d,59dOOOP-E6v-E6vO#|OPOOOOOO-E6w-E6wO%aO!bO1G.mO%aO!bO1G.mO%oO`O'#CiO%wO!bO'#CzO&VO!bO1G.mOOOP1G.m1G.mOOOP1G.z1G.zOOOW'#C}'#C}O&bOhO,59[OOOP,59[,59[O&jO`O,59]O&rO`O,59]OOOP-E6z-E6zOOOP1G.k1G.kO&zO`O,59^O'SO`O,59^O'[O!bO7+$XO'jO!bO7+$XOOOP7+$X7+$XOOOP7+$f7+$fO'uO`O,59TO'}O`O,59TO(VO!bO,59fOOOO-E6x-E6xOOOW-E6{-E6{OOOP1G.v1G.vO(eO`O1G.wO(eO`O1G.wOOOP1G.w1G.wO(mO`O1G.xO(mO`O1G.xOOOP1G.x1G.xO(uO!bO<<GsOOOP<<Gs<<GsOOOP<<HQ<<HQO'}O`O1G.oO'}O`O1G.oO)QO#tO'#ClOOOO1G.o1G.oO)`O`O7+$cOOOP7+$c7+$cO)hO`O7+$dOOOP7+$d7+$dOOOPAN=_AN=_OOOPAN=lAN=lO'}O`O7+$ZOOOO7+$Z7+$ZOOOO'#C{'#C{O)pO#tO,59WOOOO,59W,59WOOOP<<G}<<G}OOOP<<HO<<HOOOOO<<Gu<<GuOOOO-E6y-E6yOOOO1G.r1G.r",stateData:"*O~OxPOyRO{QOPvPWvP~OsUOwWO~OtXOzZO~OxPOyRO{QOPvXWvXrvX~OP]OWbO~OsUOwdO~OtXOzfO~O[iOygO~OP]OQoORkOSlOalOblOclOxPO{QO!QjO~OxPOyRO{QOPvPrvP~OP]O~OxPOyRO{QOPvP~O[uOygO~OYzO^wOg{OygO~Ou|O!P!OO~O[!QOygO~O[!UOygO~OY!XO^wOg!YOygO~O_![OygO~OygOYnX^nXgnX~OY!XO^wOg!YO~Ou|O!P!`O~O[!aOygO~OY!cOygO~O[!dOygO~OY!fOygO~OY!hO^wOg!iOygO~OY!hO^wOg!iO~O_!jOygO~OygO|!lO~OygOYna^nagna~OY!oOygO~OY!qOygO~OY!rO^wOg!sO~Oa!vOb!vO|!xO}!vO~OY!yOygO~OY!zOygO~Oa!vOb!vO|!}O}!vO~O",goto:"&R!PPPPPPP!Q!QP![P!eP!lPP!uPPP!W!W#PP#V#^#f#l#r#y%R%b%h%nPPPP%tPPPPPPP%}WROS`bTl^nU`TasTl^nZ^T^ans_xiuvy!V!W!gQ!m![S!u!j!kR!{!tQp^R!SnZ_T^ansUSO`bR[SQVPRcVQYQReYSaTsRraQh]jthv!P!T!V!Z!]!b!e!k!n!p!tQviQ!PkQ!ToQ!VuQ!ZwQ!]xQ!b!QQ!e!UQ!k![Q!n!aQ!p!dR!t!jQyiS!WuvU!^y!W!gR!g!VQ!w!lR!|!wQn^R!RnQ}jR!_}QTOQq`RsbTm^n",nodeNames:"âš  StartTag StartCloseTag StartCloseTag StartCloseTag Document Comment ProcessingInst DoctypeDecl Element EndTag OpenTag TagName Attribute AttributeName Is AttributeValue EntityReference CharacterReference Text Cdata MismatchedCloseTag CloseTag SelfCloseEndTag SelfClosingTag",maxTerm:48,context:elementContext,nodeProps:[[NodeProp.closedBy,1,"SelfCloseEndTag EndTag",11,"CloseTag"],[NodeProp.openedBy,10,"StartTag StartCloseTag",22,"OpenTag",23,"StartTag"]],skippedNodes:[0],repeatNodeCount:9,tokenData:"Bk~R!WOX$kXY%rYZ%rZ]$k]^%r^p$kpq%rqr$krs&tsv$kvw'Uw}$k}!O(q!O!P$k!P!Q*n!Q![$k![!]+z!]!^$k!^!_/s!_!`=i!`!a>U!a!b>q!b!c$k!c!}+z!}#P$k#P#Q?}#Q#R$k#R#S+z#S#T$k#T#o+z#o%W$k%W%o+z%o%p$k%p&a+z&a&b$k&b1p+z1p4U$k4U4d+z4d4e$k4e$IS+z$IS$I`$k$I`$Ib+z$Ib$Kh$k$Kh%#t+z%#t&/x$k&/x&Et+z&Et&FV$k&FV;'S+z;'S;:jAz;:j?&r$k?&r?Ah+z?Ah?BY$k?BY?Mn+z?Mn~$kY$rUcQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$kQ%ZRcQOv%Uw!^%U!_~%UW%iR}WOr%dsv%dw~%d_%{]cQ}WyTOX$kXY%rYZ%rZ]$k]^%r^p$kpq%rqr$krs%Usv$kw!^$k!^!_%d!_~$kZ&{R|XcQOv%Uw!^%U!_~%U~'XTOp'hqs'hst(Pt!]'h!^~'h~'kTOp'hqs'ht!]'h!]!^'z!^~'h~(POa~~(SROp(]q!](]!^~(]~(`SOp(]q!](]!]!^(l!^~(]~(qOb~Z(xWcQ}WOr$krs%Usv$kw}$k}!O)b!O!^$k!^!_%d!_~$kZ)iWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_!`$k!`!a*R!a~$kZ*[UwPcQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$k^*uWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_!`$k!`!a+_!a~$k^+hUgScQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$k_,V}^S[PcQ}WOr$krs%Usv$kw}$k}!O+z!O!P+z!P!Q$k!Q![+z![!]+z!]!^$k!^!_%d!_!c$k!c!}+z!}#R$k#R#S+z#S#T$k#T#o+z#o$}$k$}%O+z%O%W$k%W%o+z%o%p$k%p&a+z&a&b$k&b1p+z1p4U+z4U4d+z4d4e$k4e$IS+z$IS$I`$k$I`$Ib+z$Ib$Je$k$Je$Jg+z$Jg$Kh$k$Kh%#t+z%#t&/x$k&/x&Et+z&Et&FV$k&FV;'S+z;'S;:j/S;:j?&r$k?&r?Ah+z?Ah?BY$k?BY?Mn+z?Mn~$k_/ZWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_;=`$k;=`<%l+z<%l~$kZ/xU}WOq%dqr0[sv%dw!a%d!a!b=X!b~%dZ0aZ}WOr%dsv%dw}%d}!O1S!O!f%d!f!g1x!g!}%d!}#O5s#O#W%d#W#X:k#X~%dZ1XT}WOr%dsv%dw}%d}!O1h!O~%dZ1oRxR}WOr%dsv%dw~%dX1}T}WOr%dsv%dw!q%d!q!r2^!r~%dX2cT}WOr%dsv%dw!e%d!e!f2r!f~%dX2wT}WOr%dsv%dw!v%d!v!w3W!w~%dX3]T}WOr%dsv%dw!{%d!{!|3l!|~%dX3qT}WOr%dsv%dw!r%d!r!s4Q!s~%dX4VT}WOr%dsv%dw!g%d!g!h4f!h~%dX4kV}WOr4frs5Qsv4fvw5Qw!`4f!`!a5c!a~4fP5TRO!`5Q!`!a5^!a~5QP5cOWPX5jRWP}WOr%dsv%dw~%dY5xV}WOr%dsv%dw!e%d!e!f6_!f#V%d#V#W8w#W~%dY6dT}WOr%dsv%dw!f%d!f!g6s!g~%dY6xT}WOr%dsv%dw!c%d!c!d7X!d~%dY7^T}WOr%dsv%dw!v%d!v!w7m!w~%dY7rT}WOr%dsv%dw!c%d!c!d8R!d~%dY8WT}WOr%dsv%dw!}%d!}#O8g#O~%dY8nR}W!QQOr%dsv%dw~%dY8|T}WOr%dsv%dw#W%d#W#X9]#X~%dY9bT}WOr%dsv%dw#T%d#T#U9q#U~%dY9vT}WOr%dsv%dw#h%d#h#i:V#i~%dY:[T}WOr%dsv%dw#T%d#T#U8R#U~%dX:pT}WOr%dsv%dw#c%d#c#d;P#d~%dX;UT}WOr%dsv%dw#V%d#V#W;e#W~%dX;jT}WOr%dsv%dw#h%d#h#i;y#i~%dX<OT}WOr%dsv%dw#m%d#m#n<_#n~%dX<dT}WOr%dsv%dw#d%d#d#e<s#e~%dX<xT}WOr%dsv%dw#X%d#X#Y4f#Y~%dZ=`R{R}WOr%dsv%dw~%dZ=rU_PcQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$k_>_UYTcQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$kZ>xWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_!`$k!`!a?b!a~$kZ?kUzPcQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$kZ@UWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_#P$k#P#Q@n#Q~$kZ@uWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_!`$k!`!aA_!a~$kZAhU!PPcQ}WOr$krs%Usv$kw!^$k!^!_%d!_~$k_BRWcQ}WOr$krs%Usv$kw!^$k!^!_%d!_;=`$k;=`<%l+z<%l~$k",tokenizers:[startTag,commentContent$1,piContent$1,cdataContent$1,0,1,2,3],topRules:{Document:[0,5]},tokenPrec:0});function tagName(e,t){t=t&&t.getChild("TagName");return t?e.sliceString(t.from,t.to):""}function elementName(e,t){t=t&&t.firstChild;return t&&"OpenTag"==t.name?tagName(e,t):""}function attrName(e,t,O){let a=t&&t.getChildren("Attribute").find(e=>e.from<=O&&e.to>=O);t=a&&a.getChild("AttributeName");return t?e.sliceString(t.from,t.to):""}function findParentElement(t){for(let e=t&&t.parent;e;e=e.parent)if("Element"==e.name)return e;return null}function findLocation(e,t){var O;let a=syntaxTree(e).resolve(t,-1),n=null;for(let e=a;!n&&e.parent;e=e.parent)"OpenTag"!=e.name&&"CloseTag"!=e.name&&"SelfClosingTag"!=e.name&&"MismatchedCloseTag"!=e.name||(n=e);if(n&&(n.to>t||n.lastChild.type.isError)){var r=n.parent;if("TagName"==a.name)return"CloseTag"==n.name||"MismatchedCloseTag"==n.name?{type:"closeTag",from:a.from,context:r}:{type:"openTag",from:a.from,context:findParentElement(r)};if("AttributeName"==a.name)return{type:"attrName",from:a.from,context:n};if("AttributeValue"==a.name)return{type:"attrValue",from:a.from,context:n};e=a==n||"Attribute"==a.name?a.childBefore(t):a;return"StartTag"==(null==e?void 0:e.name)?{type:"openTag",from:t,context:findParentElement(r)}:"StartCloseTag"==(null==e?void 0:e.name)&&e.to<=t?{type:"closeTag",from:t,context:r}:"Is"==(null==e?void 0:e.name)?{type:"attrValue",from:t,context:n}:e?{type:"attrName",from:t,context:n}:null}if("StartCloseTag"==a.name)return{type:"closeTag",from:t,context:a.parent};for(;a.parent&&a.to==t&&(null===(O=a.lastChild)||void 0===O||!O.type.isError);)a=a.parent;return"Element"==a.name||"Text"==a.name||"Document"==a.name?{type:"tag",from:t,context:"Element"==a.name?a:findParentElement(a)}:null}class Element{constructor(e,t,O){this.attrs=t,this.attrValues=O,this.children=[],this.name=e.name,this.completion=Object.assign(Object.assign({type:"type"},e.completion||{}),{label:this.name}),this.openCompletion=Object.assign(Object.assign({},this.completion),{label:"<"+this.name}),this.closeCompletion=Object.assign(Object.assign({},this.completion),{label:"</"+this.name+">",boost:2}),this.closeNameCompletion=Object.assign(Object.assign({},this.completion),{label:this.name+">"}),this.text=e.textContent?e.textContent.map(e=>({label:e,type:"text"})):[]}}const Identifier=/^[:\-\.\w\u00b7-\uffff]*$/;function attrCompletion(e){return Object.assign(Object.assign({type:"property"},e.completion||{}),{label:e.name})}function valueCompletion(e){return"string"==typeof e?{label:`"${e}"`,type:"constant"}:/^"/.test(e.label)?e:Object.assign(Object.assign({},e),{label:`"${e.label}"`})}function completeFromSchema(a,e){let n=[],i=[],c=Object.create(null);for(var t of e){var O=attrCompletion(t);n.push(O),t.global&&i.push(O),t.values&&(c[t.name]=t.values.map(valueCompletion))}let m=[],g=[],p=Object.create(null);for(var r of a){let e=i,O=c;r.attributes&&(e=e.concat(r.attributes.map(t=>"string"==typeof t?n.find(e=>e.label==t)||{label:t,type:"property"}:(t.values&&(O==c&&(O=Object.create(O)),O[t.name]=t.values.map(valueCompletion)),attrCompletion(t)))));var o=new Element(r,e,O);p[o.name]=o,m.push(o),r.top&&g.push(o)}g.length||(g=m);for(let O=0;O<m.length;O++){let e=a[O],t=m[O];if(e.children)for(var s of e.children)p[s]&&t.children.push(p[s]);else t.children=m}return r=>{let{doc:o}=r.state,e=findLocation(r.state,r.pos);if(!e||"tag"==e.type&&!r.explicit)return null;var{type:t,from:s,context:l}=e;if("openTag"==t){let e=g;var O,a=elementName(o,l);return a&&(O=p[a],e=(null==O?void 0:O.children)||m),{from:s,options:e.map(e=>e.completion),span:Identifier}}if("closeTag"==t){var n=elementName(o,l);return n?{from:s,to:r.pos+(">"==o.sliceString(r.pos,r.pos+1)?1:0),options:[(null===(O=p[n])||void 0===O?void 0:O.closeNameCompletion)||{label:n+">",type:"type"}],span:Identifier}:null}if("attrName"==t){var d=p[tagName(o,l)];return{from:s,options:(null==d?void 0:d.attrs)||i,span:Identifier}}if("attrValue"==t){n=attrName(o,l,s);if(!n)return null;d=p[tagName(o,l)],n=((null==d?void 0:d.attrValues)||c)[n];return n&&n.length?{from:s,to:r.pos+('"'==o.sliceString(r.pos,r.pos+1)?1:0),options:n,span:/^"[^"]*"?$/}:null}if("tag"!=t)return null;{let e=elementName(o,l),t=p[e],O=[],a=l&&l.lastChild;!e||a&&"CloseTag"==a.name&&tagName(o,a)==e||O.push(t?t.closeCompletion:{label:"</"+e+">",type:"type",boost:2});let n=O.concat(((null===t||void 0===t?void 0:t.children)||(l?m:g)).map(e=>e.openCompletion));return l&&null!==t&&void 0!==t&&t.text.length&&((l=l.firstChild).to>r.pos-20&&!/\S/.test(r.state.sliceDoc(l.to,r.pos))&&(n=n.concat(t.text))),{from:s,options:n,span:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}}}const xmlLanguage=LezerLanguage.define({parser:parser.configure({props:[indentNodeProp.add({Element(e){var t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.state.doc.lineAt(e.node.from))+(t?0:e.unit)},"OpenTag CloseTag SelfClosingTag"(e){return e.column(e.node.from)+e.unit}}),foldNodeProp.add({Element(e){var t=e.firstChild,O=e.lastChild;return t&&"OpenTag"==t.name?{from:t.to,to:"CloseTag"==O.name?O.from:e.to}:null}}),styleTags({AttributeValue:tags.string,Text:tags.content,"StartTag StartCloseTag EndTag SelfCloseEndTag":tags.angleBracket,TagName:tags.tagName,"MismatchedCloseTag/Tagname":[tags.tagName,tags.invalid],AttributeName:tags.propertyName,UnquotedAttributeValue:tags.string,Is:tags.definitionOperator,"EntityReference CharacterReference":tags.character,Comment:tags.blockComment,ProcessingInst:tags.processingInstruction,DoctypeDecl:tags.documentMeta,Cdata:tags.special(tags.string)})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/$/}});function xml(e={}){return new LanguageSupport(xmlLanguage,xmlLanguage.data.of({autocomplete:completeFromSchema(e.elements||[],e.attributes||[])}))}export{completeFromSchema,xml,xmlLanguage};
